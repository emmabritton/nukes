<!DOCTYPE html>
<html>
  <head>
    <title>Nuclear Detonations map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/2.4.4/seedrandom.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="css/reset.css" />
    <link rel="stylesheet" type="text/css" href="css/common.css" />
    <link rel="stylesheet" type="text/css" href="css/theme.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicons/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicons/favicon-16x16.png">
    <link rel="mask-icon" href="favicons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130410803-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-130410803-1');
    </script>

  </head>
  <body id="body">
    <div id="container">
      <div id="header">
        <h1 style="float:left;">Detonations map</h1>
        <img class="toolbar_item" src="images/play.png" id="play">
        <img class="toolbar_item" src="images/pause.png" id="pause" style="display:none;">
        <img class="toolbar_item" src="images/stop.png" id="stop" style="display:none;">
        <img class="toolbar_item" src="images/fullscreen.png" id="fullscreen">
        <div class="toolbar_item check_container">
          <input type="checkbox" id="show_dets"/>
          <label for="show_dets">Show markers</label>
        </div>
        <div class="toolbar_item check_container" id="margin_left">
          <input type="checkbox" id="play_sounds"/>
          <label for="play_sounds">Play sounds</label>
        </div>
        <img src="images/info.png" id="info_button" class="info_toggle" >
        <a href="https://github.com/raybritton/nukes" target="_blank"><img src="images/github.png" id="github_button"></a>
      </div>
      <div id="content" >
        <div id="canvas_container"></div> 
      </div>
    </div>
    <div id="info_container">
      <div id="info" >
        <div id="info_title"><p class="info_toggle" id="info_close">X</p></div>
        <div id="info_text">
          <p>Data used for this website was gathered from <a href="/sipri-report-original.pdf" target="_blank">Nuclear Explosions 1945 - 1998</a> from the <a href="https://www.sipri.org/" target="_blank">Stockholm International Peace Research Institute</a> by Nils-Olov Bergkvist and Ragnhild Ferm and many pages on <a href="https://wikipedia.org" target="_blank">Wikipedia</a>.</p>
          <br/>
          <p>This site was inspiried by the <a href="https://www.youtube.com/watch?v=cjAqR1zICA0" target="_blank">video</a> created by Isao Hashimoto. The data I compiled to make this: <a href="https://docs.google.com/spreadsheets/d/1vFYsymbbNJAClq7sQ2Hp9U967JRBlX_41WCHuqDAmPg/edit?usp=sharing" target="_blank">detonations spreadsheet</a>.<br/><br/> Please contact me at <a href="raybritton@gmail.com">raybritton@gmail.com</a> about mistakes, suggestions or comments.</p>
          <br/><br/>
          <h2>Some facts</h2>
          <p class="note">kt stands for kilotons. 1 kiloton is the equivalent of 1000 tons of TNT/dynamite exploding.</p>
          <ul>
            <li>America has detonated roughly half of the nuclear devices in the world and detonated 88%% (886 devices) of theirs at the <a href="https://en.wikipedia.org/wiki/Nevada_Test_Site">NTS</a></li>
            <li>The only two devices to detonated in combat were <a href="https://en.wikipedia.org/wiki/Fat_Man">Fat Man</a> (21kt) and <a href="https://en.wikipedia.org/wiki/Little_Boy">Little Boy</a> (15kt)</li>
            <li>Only 2%% of the nuclear material fissioned on Little Boy <a href="https://www.npr.org/2014/08/11/339131421/nuclear-command-and-control-a-history-of-false-alarms-and-near-catastrophes">(source)</a></li>
            <li>The largest device ever detonated was the <a href="https://en.wikipedia.org/wiki/Tsar_Bomba">Tsar Bomba</a> by the USSR at 50000kt</li>
          </ul>
          <br/><br/>
          <p>Thanks to <a href="https://realfavicongenerator.net/">Real Favicon generator</a> for creating the favicons.</p>
          <p>Sounds modified from sounds from <a href="Free sound effects">freesoundeffects.com</a></p>        
          <div>Icons made by <a href="https://www.freepik.com/" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" 			    title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" 			    title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div>  
        </div>
      </div>
    </div>
    <div id="loading_container">
      <p>Loading</p>
    </div>
    <script>
      
      const DATA = {
        COUNTRIES: %s,
        DETONATIONS: %s
      };
      const CONFIG = {
        sound: false,
        keepDetonationMarkers: false,
        slowOnImportant: true
      };
      const PARAM = {
        SOUND: "sound",
        MARKERS: "keepMarkers",
        SLOW: "slow",
        INFO: "info"
      }
    </script>
    <script src="js/data.js"></script>
    <script src="js/world.js"></script>
    <script src="js/common.js"></script>
    <script>
      var iOS = false;
      var canvasContainer = $('#canvas_container');
      var stopButton = $('#stop');
      var playButton = $('#play');
      var pauseButton = $('#pause');
      var keepDetonations = $('#show_dets');
      var playSounds = $('#play_sounds');

      function analyticEvent(action, category, label) {
          gtag('event', action, {
            'event_category': category,
            'event_label': label
          });
      }

      $(document).ready(function(){
        iOS = !!navigator.platform && /iPad|iPhone|iPod/.test(navigator.platform);

        if (iOS) {
          $('#fullscreen').hide();
        }

        setupDetonationsData();

        setupCanvas();
        tl_init(canvasContainer);

        setReadyCallback(function() {
          $('#loading_container').hide();
          playButton.on('click', () => {
            view_play(false)
          });
          setTimeout(function() {
            view_play(true);
          }, 500);
        });
        
        pauseButton.on('click', () => {
          analyticEvent('pause', 'player');
          tl_pause();
          playButton.show();
          pauseButton.hide();
          stopButton.show();
        });
        stopButton.on('click', () => {
          analyticEvent('stop', 'player');
          tl_stop();
          playButton.show();
          pauseButton.hide();
          stopButton.hide();
        });
      });

      function view_play(auto) {
        if (auto) {
          analyticEvent('start', 'player');
        } else {
          analyticEvent('play', 'player');
        }
        tl_play()
        playButton.hide();
        pauseButton.show();
        stopButton.show();
      }

      $(window).resize(function() {
        setupCanvas();
      });

      $(window).on('popstate', function () {
        var container = $('#info_container');
        if (container.is(":visible")) {
          analyticEvent('closed', 'info');
          setUrlParam(PARAM.INFO);
          $('#info_container').toggle()
        } else {
          history.back();
        }
      });

      $(window).on('touchstart', function () {
        tl_setIsTouchDevice(true);
      });

      function view_onTimelimeJump(isPlaying) {
        if (isPlaying) {
          playButton.hide();
          pauseButton.show();
          stopButton.show();
        } else {
          playButton.show();
          pauseButton.hide();
          stopButton.show();
        }
      }

      function view_onEndReached() {
        playButton.show();
        pauseButton.hide();
        stopButton.hide();
      }

      setupCheckbox(playSounds, 'sound', PARAM.SOUND);
      setupCheckbox(keepDetonations, 'keepDetonationMarkers', PARAM.MARKERS);

      $('#fullscreen').on('click', () => {
        analyticEvent('fullscreen toggle', 'player');
        toggleFullScreen()
      });
      $('.info_toggle').on('click', () => {
        tl_pause()
        playButton.show();
        pauseButton.hide();
        stopButton.show();
        var container = $('#info_container');
        if (container.is(":visible")) {
          analyticEvent('closed', 'info');
        } else {
          analyticEvent('opened', 'info');
        }
        $('#info_container').toggle()
      });

      function setupCanvas() {
        canvasContainer.empty();
        var canvas = $('<canvas width="' + canvasContainer.width() + '" height="' + canvasContainer.height() + '"></canvas>')[0];
        canvasContainer.append(canvas);
        var ctx = canvas.getContext("2d");
        ctx.imageSmoothingEnabled = false;
        ctx.globalCompositeOperation = 'source-over';
  
        tl_resize(ctx, canvas.width, canvas.height);
      }

      function setupCheckbox(button, configVarName, paramVarName) {
        button.on('click', function() {
          analyticEvent(paramVarName, 'settings', button.prop('checked'));
          CONFIG[configVarName] = button.prop('checked');
        });
      }
    </script>
  </body>
</html>