<!DOCTYPE html>
<html>
  <head>
    <title>Nuclear detonations map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/2.4.4/seedrandom.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="css/reset.css" />
    <link rel="stylesheet" type="text/css" href="css/common.css" />
    <link rel="stylesheet" type="text/css" href="css/theme.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicons/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicons/favicon-16x16.png">
    <link rel="mask-icon" href="favicons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#ffc40d">
    <meta name="theme-color" content="#ffffff">
  </head>
  <body id="body">
    <div id="container">
      <div id="header">
        <h1 style="float:left;">Nuclear detonations map</h1>
        <img src="images/play.png" id="play">
        <img src="images/pause.png" id="pause" style="display:none;">
        <img src="images/stop.png" id="stop" style="display:none;">
        <img src="images/fullscreen.png" id="fullscreen">
        <input type="checkbox" id="show_dets" checked>Keep detonation markers</input>
        <input type="checkbox" id="play_sounds" checked>Play sounds</input>
        <img src="images/info.png" id="info_button" class="info_toggle" >
        <a href="https://github.com/raybritton/nukes" target="_blank"><img src="images/github.png" id="github_button"></a>
      </div>
      <div id="content" >
        <div id="canvas_container"></div> 
      </div>
    </div>
    <div id="info_container">
      <div id="info" >
        <div id="info_title"><p class="info_toggle" id="info_close">X</p></div>
        <div id="info_text">
          <p>Data used for this website was gathered from <a href="/sipri-report-original.pdf" target="_blank">Nuclear Explosions 1945 - 1998</a> from the <a href="https://www.sipri.org/" target="_blank">Stockholm International Peace Research Institute</a> by Nils-Olov Bergkvist and Ragnhild Ferm and many pages on <a href="https://wikipedia.org" target="_blank">Wikipedia</a>.</p>
          <br/>
          <p>This site was inspiried by the <a href="https://www.youtube.com/watch?v=cjAqR1zICA0" target="_blank">video</a> created by Isao Hashimoto. The data I compiled to make this: <a href="https://docs.google.com/spreadsheets/d/1vFYsymbbNJAClq7sQ2Hp9U967JRBlX_41WCHuqDAmPg/edit?usp=sharing" target="_blank">detonations spreadsheet</a>.<br/><br/> Please contact me at <a href="raybritton@gmail.com">raybritton@gmail.com</a> with about mistakes, suggestions or comments.</p>
          <br/><br/>
          <p>Thanks to <a href="https://realfavicongenerator.net/">Real Favicon generator</a> for creating the favicons.</p>
          <p>Sounds from <a href="Free sound effects">freesoundeffects.com</a></p>        
          <div>Icons made by <a href="https://www.freepik.com/" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" 			    title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" 			    title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div>  
      </div>
      </div>
    </div>
    <script>
      const DATA = {
        COUNTRIES: %s,
        DETONATIONS: %s
      };
      const CONFIG = {
        sound: true,
        keepDetonationMarkers: false,
        slowOnImportant: true
      };
      const PARAM = {
        SOUND: "sound",
        MARKERS: "keepMarkers",
        SLOW: "slow"
      }
    </script>
    <script src="js/data.js"></script>
    <script src="js/world.js"></script>
    <script src="js/common.js"></script>
    <script>
      var canvasContainer = $('#canvas_container');
      var stopButton = $('#stop');
      var playButton = $('#play');
      var pauseButton = $('#pause');
      var keepDetonations = $('#show_dets');
      var playSounds = $('#play_sounds');

      $(document).ready(function(){
        setupConfig();  
        setupDetonationsData();
        tl_setup();

        setupCanvas();
        tl_init(canvasContainer);

        playButton.on('click', () => {
          tl_play()
          playButton.hide();
          pauseButton.show();
          stopButton.show();
        });
        pauseButton.on('click', () => {
          tl_pause()
          playButton.show();
          pauseButton.hide();
          stopButton.show();
        });
        stopButton.on('click', () => {
          tl_stop()
          playButton.show();
          pauseButton.hide();
          stopButton.hide();
        });
      });

      $(window).resize(function() {
        setupCanvas();
      });

      setupCheckbox(playSounds, 'sound', PARAM.SOUND);
      setupCheckbox(keepDetonations, 'keepDetonationMarkers', PARAM.MARKERS);

      $('#fullscreen').on('click', () => toggleFullScreen());
      $('.info_toggle').on('click', () => $('#info_container').toggle());

      function setupCanvas() {
        canvasContainer.empty();
        var canvas = $('<canvas width="' + canvasContainer.width() + '" height="' + canvasContainer.height() + '"></canvas>')[0];
        canvasContainer.append(canvas);
        var ctx = canvas.getContext("2d");
        ctx.imageSmoothingEnabled = false;
        ctx.globalCompositeOperation = 'source-over';
  
        tl_resize(ctx, canvas.width, canvas.height);
      }

      function setupCheckbox(button, configVarName, paramVarName) {
        button.on('click', function() {
          CONFIG[configVarName] = button.prop('checked');
          var url = new URL(window.location.href);
          url.searchParams.set(paramVarName, CONFIG[configVarName]);
          window.history.pushState({}, "Nuclear detonations map", url);
        });
      }

      function setupConfig() {
        var url = new URL(window.location.href);
        if (url.searchParams.get(PARAM.SOUND)) {
          CONFIG.sound = url.searchParams.get(PARAM.SOUND) === "true";
          playSounds.prop('checked', CONFIG.sound);
        }
        if (url.searchParams.get(PARAM.MARKERS)) {
          CONFIG.keepDetonationMarkers = url.searchParams.get(PARAM.MARKERS) === "true";
          keepDetonations.prop('checked', CONFIG.keepDetonationMarkers);
        }
        if (url.searchParams.get(PARAM.SLOW)) {
          CONFIG.slowOnImportant = url.searchParams.get(PARAM.SLOW) === "true";
        }
      }
    </script>
  </body>
</html>