<!DOCTYPE html>
<html>
  <head>
    <title>Nuclear detonations map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/2.4.4/seedrandom.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="css/reset.css" />
    <link rel="stylesheet" type="text/css" href="css/common.css" />
    <link rel="stylesheet" type="text/css" href="css/theme.css" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=%s"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', '%s');
    </script>

  </head>
  <body id="body">
    <div id="container">
      <div id="header">
        <h1 style="float:left;">Animated detonations map</h1>
        <img src="images/play.png" id="play">
        <img src="images/stop.png" id="stop" style="display:none;">
        <img src="images/fullscreen.png" id="fullscreen">
        <button id="show_dets">Show all detonations</button>
        <img src="images/info.png" id="info_button">
        <a href="https://github.com/raybritton/nukes" target="_blank"><img src="images/github.png" id="github_button"></a>
      </div>
      <div id="content" >
        <div id="map_container">
        
        </div>
        <div id="timeline_container">
          
        </div>  
      </div>
    </div>
    <div id="country_container">
      
    </div>
    <div id="date_container">
      <p id="date"></p>
    </div>
    <div id="info_container">
      <div id="info" >
        <div id="info_title"><p id="info_close">X</p></div>
        <div id="info_text">
          <p>Data used for this website was gathered from <a href="/sipri-report-original.pdf" target="_blank">Nuclear Explosions 1945 - 1998</a> from the <a href="https://www.sipri.org/" target="_blank">Stockholm International Peace Research Institute</a> by Nils-Olov Bergkvist and Ragnhild Ferm and many pages on <a href="https://wikipedia.org" target="_blank">Wikipedia</a>.</p>
          <br/>
          <p>This site was inspiried by the <a href="https://www.youtube.com/watch?v=cjAqR1zICA0" target="_blank">video</a> created by Isao Hashimoto. The data I compiled to make this: <a href="https://docs.google.com/spreadsheets/d/1vFYsymbbNJAClq7sQ2Hp9U967JRBlX_41WCHuqDAmPg/edit?usp=sharing" target="_blank">detonations spreadsheet</a>.<br/><br/> Please contact me at <a href="raybritton@gmail.com">raybritton@gmail.com</a> with about mistakes, suggestions or comments.</p>
      </div>
      </div>
    </div>
    <script>
      const config = {
        "coloring": "country",
        "sound": "on",
        "keepDetonations": false,
        "slowOnImportant": true
      };
    </script>
    <script src="js/data.js"></script>
    <script src="js/map.js"></script>
    <script src="js/timeline.js"></script>
    <script>
      var mapContainer = $('#map_container');
      var timelineContainer = $('#timeline_container');
      var date = $('#date')[0];
      var countryListing = $('#country_container');
      var stopButton = $('#stop');
      var playButton = $('#play');

      $(document).ready(function(){
        var setupNeeded = true;
        const rng = new Math.seedrandom('nukes');
        
        detonations.forEach(det => {
          if (typeof det.special == 'undefined') {
            var xAdjust = getAdjustment(rng());
            var yAdjust = getAdjustment(rng());

            det.x = parseFloat(det.x) + xAdjust;
            det.y = parseFloat(det.y) + yAdjust;
          }
          det.date = new Date(det.date);
        });

        reset(function(){
          drawWorld();

          playButton.on('click', function() {
            if (setupNeeded) {
              resetTimeline();
              setupNeeded = false;
            }
            gtag('event', 'play');
            resetData();
            playTimeline();
            stopButton.toggle();
            playButton.toggle();
          })
          $('#show_dets').on('click', function() {
            gtag('event', 'show detonations', {
              'event_label': ((playButton.css('display') == 'none') ? 'inMidPlay - ' : '') + (currentDay ? currentDay.getFullYear() : 'Never played')
            });
            setupNeeded = true;
            stopTimeline();
            stopButton.hide();
            playButton.show();
            resetData();
            drawDetonated(0, detonations.length - 1);
          });
        });

        stopButton.on('click', function() {
          gtag('event', 'stop');
          pauseTimeline();
          stopButton.hide();
          playButton.show();
        });
      });

      $('#fullscreen').on('click', function() {
        toggleFullScreen();
      });

      $(window).resize(function() {
        gtag('event', 'resized');
        reset();
        resetTimeline();
        drawWorld();
        stopTimeline();
        stopButton.hide();
        playButton.show();
      });

      function getAdjustment(value) {
        if (value < 0.15) {
          return -0.002;
        } else if (value < 0.3) {
          return -0.001;
        } else if (value > 0.85) {
          return 0.002;
        } else if (value > 0.7) {
          return 0.001;
        } else {
          return 0;
        }
      }

      function drawCountryStats() {
        countryListing.empty();
        Object.keys(countries).forEach(function (name) {
          var country = countries[name];
          var line = "<p";
          if (config.coloring == "country") {
            line += " style=\"color:" + country.color.marker + "\"";
          }
          line += ">" + name + ": " + country.detonations + "</p";
          countryListing.append(line);
        });
      }

      function toggleFullScreen() {
        if (!document.fullscreenElement &&    // alternative standard method
            !document.mozFullScreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement ) {  // current working methods
          if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen();
          } else if (document.documentElement.msRequestFullscreen) {
            document.documentElement.msRequestFullscreen();
          } else if (document.documentElement.mozRequestFullScreen) {
            document.documentElement.mozRequestFullScreen();
          } else if (document.documentElement.webkitRequestFullscreen) {
            document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
          }
        } else {
          if (document.exitFullscreen) {
            document.exitFullscreen();
          } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
          } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
          } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
          }
        }
      }

      $('#info_button').on('click', function() {
        gtag('event', 'info');
        $('#info_container').toggle();
      });

      $('#info_close').on('click', function() {
        $('#info_container').toggle();
      });
    </script>
  </body>
</html>